# 优课在线自动挂机脚本

## 🌟 项目简介

本项目是一个基于 Python 和 DrissionPage 框架开发的自动化脚本，专为解决优课学习平台的网课自动挂机，实现了高效的课程目录遍历、视频播放保活以及自动切换至下一个未完成的视频功能。
对该项目如有任何疑问，可以加主包vx沟通：hjm948663969

**注意：代码会跳过测验节点，需要用户自己完成测验。**

## ⚙️ 核心技术栈

| 技术 | 作用 |
| :--- | :--- |
| **Python** | 脚本主体语言。|
| **DrissionPage** | 底层驱动库，用于控制无头或有头 Chrome 浏览器。本项目通过连接到调试端口的 Chrome 实例进行操作，效率高且隐蔽性好。|
| **内存树 (DOM Tree)** | 使用 `navigator_logic.py` 构建课程目录的虚拟树结构，实现毫秒级的导航决策。|
| **JS 注入** | 用于视频防暂停、播放状态检测以及避免浏览器休眠。|

## 🚀 脚本工作原理

### 1. 导航与决策 (navigator_logic.py)

脚本的核心是其强大的导航决策能力，它在内存中模拟了整个课程目录结构：

* **构建内存树：** 脚本运行时，会快速扫描页面左侧的课程目录 DOM，将其转换为一个内存中的虚拟树结构。
* **锚点定位：** 通过匹配 URL 和当前节点的 `active` 状态，精确定位用户当前正在观看的节点（**锚点**）。
* **智能决策：**
    * 如果当前锚点是**未完成的视频**：保持等待（返回“正在播放”）。
    * 如果当前锚点已**完成**或当前节点是**非挂机类型**（如附件、文档、**测验**）：寻找锚点之后的第一个**未完成的视频**节点。
    * 如果发现容器（章/节）处于**折叠**状态且内部有未完成任务：执行点击操作将其展开。
    * **测验跳过：** 遇到标题中包含“测验”、“考试”、“作业”等关键词的节点时，无论其状态是否完成，脚本都会**强制将其跳过**，直接寻找下一个视频任务。

### 2. 视频保活与防暂停（main.py)

脚本在检测到当前是视频页面后，会进入监控模式，主要通过以下机制确保播放不中断：

* **Keep-Alive 注入：** 定期向页面注入 JavaScript 代码，欺骗浏览器以为当前页面处于**可见状态** (`document.hidden = false`)，防止视频因标签页处于后台而自动暂停。
* **自动恢复播放：** 脚本会检测视频播放器上的暂停按钮（如 `.vjs-big-play-button`）是否显示，如果检测到暂停，会尝试模拟点击屏幕中心来恢复播放。

### 3. 日志与独立运行（main.py）

* **独立运行：** 通过将所有配置项整合到 `main.py` 内部并使用 PyInstaller 打包为 `优课挂机助手.exe`，程序可以**脱离 `config.py` 文件独立运行**，极大地简化了用户的使用和部署。
* **日志保存：** 脚本使用兼容性日志路径修复，确保无论是脚本运行还是 `.exe` 运行，运行时信息和错误都会被记录在 `.exe` 同级目录下的 `logs/` 文件夹中，方便用户进行问题排查和运行状态检查。

## ⚠️ 使用注意事项

### 1. 运行环境要求

* **浏览器：** 必须安装 **Google Chrome** 浏览器，用于脚本连接和控制。
* 启动脚本后，将自动打开一个新的谷歌浏览器窗口，你需要手动进入网课的视频播放页面，然后就可以放手挂机了。
* **不建议将窗口缩小或最小化**，可能导致代码运行不稳定。但是支持让其它窗口覆盖在网课窗口上，看其它视频、玩游戏不影响，不要求电脑聚焦在网课窗口。
* **代码主要支持Windows系统**，mac系统没有主动测试过（但是周围人尝试运行main.py可以正常挂课，我这边不保证能正常跑）

### 2. 配置文件说明 (已内嵌)

本项目将核心配置（如端口、超时时间）硬编码到 `.exe` 中，默认配置如下：

| 配置项 | 默认值 | 描述 |
| :--- | :--- | :--- |
| `CHROME_DEBUG_PORT` | `9222` | Chrome 调试端口，必须与启动 Chrome 时指定的端口一致。|
| `WATCHDOG_TIMEOUT` | `300.0` 秒 | 脚本长时间（5分钟）没有有效操作时，将自动刷新页面。|
| `FORCE_REFRESH_INTERVAL` | `600.0` 秒 | 脚本将每隔 10 分钟强制刷新一次页面，防止页面长时间运行导致的内存泄漏或卡死。|

### 3. 日志清理

由于脚本在播放视频时会产生大量的浏览器缓存数据，这会导致 Chrome 用户配置文件（即您启动 Chrome 时指定的 `--user-data-dir` 目录）占用巨大的磁盘空间。

* **建议：** 定期手动或通过脚本清理该 Chrome 调试目录下的 `Cache` 和 `Media Cache` 文件夹，以释放空间。把整个文件夹删除即可。

## 详细使用说明：

* 可以选择使用启动器启动（Windows），也可以直接运行exe文件（Windows）。若有需要直接运行main.py，建议安装虚拟环境，然后在虚拟环境中运行main.py。

### 环境部署：
* Windows创建虚拟环境：

```
python -m venv lite_env
```

* 启动虚拟环境：

```
lite_env\Scripts\activate
```

* 将requirements.txt内的环境安装到虚拟环境中：

```
pip install -r requirements.txt
```

之后就可以直接运行main.py以及其它文件了。

* **如果不想部署环境那么麻烦，可以直接运行`优课挂机脚本.exe`**


### 代码启动后，到放手挂机前：

* 在程序启动后，会占用9222端口启动谷歌浏览器，此时用户需手动打开优课的视频挂机页面，当代码检测到网课视频后，就会自动接管控制，这个时候就可以把窗口挪到小角落挂机了。

### 日志保存：

* 日志将保存在代码或exe文件同目录下的logs文件夹。

### 缓存内容chrome_debug_profile：

* 如果不通过exe文件来运行程序，则会产生缓存文件夹chrome_debug_profile，由于代码没有自动清理机制，该文件夹可能会愈发臃肿，删除该文件夹不影响程序的运行。

### 配置修改：

* 配置文件在config.py内，用户如有需要可以通过修改内部的参数。
* **修改config.py不会影响exe文件的参数配置。**

## 关于测验节点

* 本来我想尝试所有题目穷举完成，但发现提交次数太多会触发人机验证，一时半会儿不知道怎么解决，于是放弃了。但是现在quiz_get_text可以快速获取测验节点的题目文字内容，方便复制给AI答题。只需在测验节点界面允许一下命令即可：

* 启动虚拟环境
```
lite_env\Scripts\activate
```

* 允许代码
```
python quiz_get_text.py
```

